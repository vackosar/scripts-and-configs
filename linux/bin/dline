#!/bin/sh
set -e
#set -x


# implement using awk script 
# * FS="[^a-zA-Z0-9]" and per-line array

f_split () {
	sed -e '
		s \([0-9a-zA-Z]\+\) \1\n g;
		s \([^0-9a-zA-Z]\) \1\n g' |
			sed -e '/^$/d'
}
f_wordDiff () {
		awk \
			'
			ARGV[1]==FILENAME {a[FNR]=$0; next}
			#a[FNR]==$0 {gsub(/./, "`");}
			a[FNR]==$0 {sub(/^/, "\033[34m"); sub(/$/, "\033[0m")}
			{print $0}
			 ' \
				$l_psplit $l_split |
					tr -d '\n'
		echo
}
main () {
  l_psplit=`mktemp`
  l_split=`mktemp`
	echo "crap" > $l_psplit
  while read s_line; do
  	echo "$s_line" |
  	  f_split > $l_split
    f_wordDiff 
		cat $l_split > $l_psplit
  done;
}
test () {
	l_psplit=test/ps
	l_split=test/s
	echo 'dir1/dir2/file1' | f_split > $l_psplit
	echo 'dir1/dir3/file1' | f_split > $l_split

}

main
#test
